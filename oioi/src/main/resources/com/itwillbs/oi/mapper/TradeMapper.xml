<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.itwillbs.oi.mapper.TradeMapper">
	<select id="selectProductCondition">
		select name , code , value  
		from common c 
		where name = 'PD_CONDTION';
	</select>
	
	<select id="selectTradeMethod">
		select name , code , value  
		from common c 
		where name = 'PD_METHOD';
	</select>
	
	<select id="selectProductPriceOffer">
		SELECT name , code , value  
		FROM common c 
		WHERE name = 'PD_PRICE_OFFER';
	</select>
	
	<select id="selectProductSafeTrade">
		SELECT name , code , value  
		FROM common c 
		WHERE name = 'PD_SAFE_TRADE';
	</select>
	
	<insert id="insertProduct" >
		 INSERT INTO product 
		 VALUES (
			  NULL -- PD_IDX
            , #{US_ID} -- US_ID
            , #{PD_CATEGORY} -- PD_CATEGORY
            , #{PD_SUBJECT} -- PD_SUBJECT
            , #{PD_CONTENT} -- PD_CONTENT
            , #{PD_IMAGE} -- PD_IMAGE
            , #{PD_PRICE} -- PD_PRICE
            , #{PD_PRICE_OFFER} -- PD_PRICE_OFFER
            , #{PD_STATUS} -- PD_STATUS 
            , #{PD_CONDITION} -- PD_CONDITION
            , #{PD_TRADE_METHOD} -- PD_TRADE_METHOD
            , #{PD_SAFE_TRADE} -- PD_SAFE_TRADE
            , NOW() -- PD_REG_DATE
            , NOW() --PD_UPDATED_DATE
            , 0 -- PD_READCOUNT
            , #{PD_TEMP_SAVE} -- PD_TEMP_SAVE
            , #{PD_TAG1} -- PD_TAG1
            , #{PD_TAG2} -- PD_TAG2
            , #{PD_TAG3} -- PD_TAG3
            , #{PD_TAG4} -- PD_TAG4
            , #{PD_TAG5} -- PD_TAG5
        );
	</insert>
	
	<select id="selectProduct">
		SELECT * 
		FROM product p 
		JOIN images i
		ON p.PD_IMAGE = i.IMG_IDX
		ORDER BY PD_IDX DESC ;
	</select>
	
	<select id="selectProductInfo" resultType="hashmap">
		SELECT *
		FROM product p
		JOIN images i
		ON p.PD_IMAGE = i.IMG_IDX
		WHERE PD_IDX = #{PD_IDX};
	</select>
	
	<select id="getProductStatus">
		select name , code , value  
		from common c 
		where name = 'PD_STATUS';
	</select>
	
	<update id="updateReadCount">
		UPDATE product
		SET PD_READCOUNT = PD_READCOUNT + 1
		WHERE PD_IDX = #{pd_idx}
	</update>
	
	 <select id="selectFilteredProducts" resultType="map">
        SELECT *
        FROM product p
        JOIN images i ON p.PD_IMAGE = i.IMG_IDX
        WHERE 1=1
        <if test="cate1 != null and cate1 != ''">
            AND p.PD_CATEGORY LIKE CONCAT('%', #{cate1}, '%')
        </if>
        <if test="cate2 != null and cate2 != ''">
            AND p.PD_CATEGORY LIKE CONCAT('%', #{cate2}, '%')
        </if>
        <if test="cate3 != null and cate3 != ''">
            AND p.PD_CATEGORY LIKE CONCAT('%', #{cate3}, '%')
        </if>
        ORDER BY p.PD_IDX DESC
    </select>
	
	
	
</mapper>















